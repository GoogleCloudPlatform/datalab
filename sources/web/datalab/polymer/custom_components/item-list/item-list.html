<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/iron-list/iron-list.html">
<link rel="import" href="../../bower_components/paper-checkbox/paper-checkbox.html">
<link rel="import" href="../../bower_components/paper-item/paper-item.html">

<dom-module id="item-list">
  <template>

    <style include="datalab-shared-styles">
      .row {
        user-select: none;
        padding: 0px;
        display: flex;
        --paper-item-min-height: 35px;
        line-height: 35px;
        cursor: default;
      }
      .row:nth-child(even) {
        background-color: #fafafa;
      }
      .row:hover {
        background-color: var(--app-secondary-color);
      }
      .row[selected] > * {
        color: var(--selection-fg-color);
      }
      .checkbox-col {
        flex-basis: 50px;
        text-align: center;
      }
      .checkbox-col > paper-checkbox {
        --paper-checkbox-size: 15px;
        --paper-checkbox-checked-color: var(--selection-fg-color);
      }
      .name-col {
        flex-grow: 1;
      }
      .name-col > iron-icon {
        width: 20px;
        height: 20px;
      }
      .status-col {
        flex-basis: 200px;
      }
    </style>

    <template is="dom-repeat" id="list" items="{{rows}}">
      <paper-item class="row" selected$={{item.selected}} on-click="_rowClicked"
                  on-dblclick="_rowDblClicked">
        <div class="checkbox-col">
          <paper-checkbox checked={{item.selected}} checkedChanged="_rowClicked"></paper-checkbox>
        </div>
        <div class="name-col">
          <iron-icon icon={{item.icon}}></iron-icon>
          [[item.name]]
        </div>
        <div class="status-col">
          [[item.status]]
        </div>
      </paper-item>
    </template>

  </template>
</dom-module>

<script>
  class ItemListElement extends Polymer.Element {

    static get is() { return "item-list"; }

    static get properties() {
      return {
        rows: {
          type: Array,
          value: function() {
            return [];
          }
        },
        columns: {
          type: Array,
          value: []
        }
      }
    }

    _rowClicked(e) {
      const index = this.$.list.indexForElement(e.target);
      const selected = this.rows[index].selected;

      // if the clicked element is the checkbox, we're done, the checkbox already
      // toggles selection (see the dom-repeat template)
      // otherwise, select this element, unselect all others
      if (e.target.tagName !== 'PAPER-CHECKBOX') {
        for (let i = 0; i < this.rows.length; ++i) {
          this.set('rows.' + i + '.selected', false);
        }
        this.set('rows.' + index + '.selected', true);
      }
    }

    _rowDblClicked(e) {
      const index = this.$.list.indexForElement(e.target);
      //const selected = this.rows[index].selected;
      this.dispatchEvent(new CustomEvent('itemDblClick', {detail: {index: index}}));
    }

  }

  customElements.define(ItemListElement.is, ItemListElement);
</script>


